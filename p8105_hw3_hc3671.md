p8105_hw3_hc3671
================
Barry
2025-10-06

## Problem 1

Loading data and set options:

``` r
library(p8105.datasets)

library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

data("instacart")

instacart = janitor::clean_names(instacart)

instacart |> 
  count(department, name = "number") |>  # not gonna show results here for aes
  mutate(max_department = department[which.max(number)], min_department = department[which.min(number)])
```

    ## # A tibble: 21 × 4
    ##    department      number max_department min_department
    ##    <chr>            <int> <chr>          <chr>         
    ##  1 alcohol           5598 produce        bulk          
    ##  2 babies           14941 produce        bulk          
    ##  3 bakery           48394 produce        bulk          
    ##  4 beverages       114046 produce        bulk          
    ##  5 breakfast        29500 produce        bulk          
    ##  6 bulk              1359 produce        bulk          
    ##  7 canned goods     46799 produce        bulk          
    ##  8 dairy eggs      217051 produce        bulk          
    ##  9 deli             44291 produce        bulk          
    ## 10 dry goods pasta  38713 produce        bulk          
    ## # ℹ 11 more rows

``` r
num_customers = n_distinct(instacart$user_id)
mean_day_since_last_order = mean(instacart$days_since_prior_order)
max_dow = names(which.max(table(instacart$order_dow)))
min_dow = names(which.min(table(instacart$order_dow)))
total_product_number = sum(unique(instacart$product_id))
num_reorder = sum(instacart$reordered)
num_orderfirst = sum(1 - instacart$reordered)
```

I made a look at the whole data set, this is a data about information on
grocery orders on the Instacart online grocery platform in the United
States. It has 15 variables in total. Key variables include: `order_id`:
Unique identifier for each order. `user_id`: Identifier for the
customer. `product_id` and `product_name`: Identifier for the purchased
item. `department` and `aisle`: Categorical variables of the products.
`order_dow` and `order_hour_of_day`: Day of the week and hour of the
orders. `days_since_prior_order`: Number of days since the user’s
previous order. `reordered`: A binary indicator indicates whether the
user has purchased this product before (0/1).

I made some basic statistical tests like: there are 131209 customers and
971525040 products involved in this data, the mean of the
days_since_prior_order is 17.0661259, the max order_dow is 0, the
minimum order_dow is 3, the number of reodered cases is 828824, while
there are 5.55793^{5} customers that order online for the first time.

Next, I am gonna answer the questions listed in question 1:

(a). How many aisles are there, and which aisles are the most items
ordered from?

    ## # A tibble: 1 × 2
    ##   num_aisle most_ordered_aisle
    ##       <int> <chr>             
    ## 1       134 yogurt

There are 134 aisles, and yogurts are the most items.

(b). Make a plot that shows the number of items ordered in each aisle,
limiting this to aisles with more than 10000 items ordered. Arrange
aisles sensibly, and organize your plot so others can read it.

``` r
instacart |> 
  count(aisle, name = "num_aisle") |> 
  filter(num_aisle >= 10000) |>  
  ggplot(aes(x = aisle, y = num_aisle)) +
  geom_col() + 
  coord_flip() +
  labs(
    x = "Aisle",
    y = "Number of items ordered",
    title = "the number of items ordered in each aisle "
  ) +
  scale_y_continuous(trans = "sqrt")
```

<img src="p8105_hw3_hc3671_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

(c). Make a table showing the three most popular items in each of the
aisles “baking ingredients”, “dog food care”, and “packaged vegetables
fruits”. Include the number of times each item is ordered in your table.

``` r
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(aisle) |> 
  count(product_name, name = "number_of_times", sort = TRUE) |> 
  mutate(numbers_ranking = min_rank(-number_of_times)) |> 
  filter(numbers_ranking %in% c(1, 2, 3))
```

    ## # A tibble: 9 × 4
    ## # Groups:   aisle [3]
    ##   aisle                      product_name        number_of_times numbers_ranking
    ##   <chr>                      <chr>                         <int>           <int>
    ## 1 packaged vegetables fruits Organic Baby Spina…            9784               1
    ## 2 packaged vegetables fruits Organic Raspberries            5546               2
    ## 3 packaged vegetables fruits Organic Blueberries            4966               3
    ## 4 baking ingredients         Light Brown Sugar               499               1
    ## 5 baking ingredients         Pure Baking Soda                387               2
    ## 6 baking ingredients         Cane Sugar                      336               3
    ## 7 dog food care              Snack Sticks Chick…              30               1
    ## 8 dog food care              Organix Chicken & …              28               2
    ## 9 dog food care              Small Dog Biscuits               26               3

(d). Make a table showing the mean hour of the day at which Pink Lady
Apples and Coffee Ice Cream are ordered on each day of the week; format
this table for human readers (i.e. produce a 2 x 7 table).

``` r
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarise(
    mean_hour_of_day = mean(order_hour_of_day)
  ) |> 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_of_day
  ) |> 
  set_names(c("Product_name", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the
    ## `.groups` argument.

    ## # A tibble: 2 × 8
    ## # Groups:   Product_name [2]
    ##   Product_name     Sunday Monday Tuesday Wednesday Thursday Friday Saturday
    ##   <chr>             <dbl>  <dbl>   <dbl>     <dbl>    <dbl>  <dbl>    <dbl>
    ## 1 Coffee Ice Cream   13.8   14.3    15.4      15.3     15.2   12.3     13.8
    ## 2 Pink Lady Apples   13.4   11.4    11.7      14.2     11.6   12.8     11.9
